/*!
 * N2.js v0.0.1
 * (c) 2018 Peng Yubin
 */
(function(e,t){typeof
exports=="object"&&typeof
module!="undefined"?module.exports=t():typeof
define=="function"&&define.amd?define(t):e.newton=t()})(this,function(){function
r(e){return
new
n(Math.cos(e),Math.sin(e))}function
i(e){return
new
n(Math.cos(e),-Math.sin(e))}var
e={},t=function(){};t.extend=function(e){function
i(){i.prototype.ctor.apply(this,arguments)}var
t=this.prototype,n=Object.create(this.prototype);for(var
r
in
e)n[r]=r==="ctor"?function(e,n){return
function(){var
r=this._super;this._super=t[e];var
i=n.apply(this,arguments);return
this._super=r,i}}(r,e[r]):e[r];return
i.prototype=n,i.prototype._super=Object.create(this.prototype),i.prototype.constructor=i,i.extend=arguments.callee,i};var
n=t.extend({ctor:function(e,t){this.x=e,this.y=t},clone:function(){return
new
n(this.x,this.y)},lengthSqr:function(){return
this.x*this.x+this.y*this.y},length:function(){return
Math.sqrt(this.lengthSqr())},normalize:function(){var
e=1/this.length();return
this.x*=e,this.y*=e,this},assign:function(e){return
this.x=e.x,this.y=e.y,this},rotatedCCW:function(){return
new
n(-this.y,this.x)},rotatedCW:function(){return
new
n(this.y,-this.x)},add:function(e){return
this.x+=e.x,this.y+=e.y,this},sub:function(e){return
this.x-=e.x,this.y-=e.y,this},addOfMultiplied:function(e,t){return
this.x+=e.x*t,this.y+=e.y*t,this},subOfMultiplied:function(e,t){return
this.x-=e.x*t,this.y-=e.y*t,this},multiply:function(e){return
this.x*=e,this.y*=e,this},dot:function(e){return
this.x*e.x+this.y*e.y},cross:function(e){return
this.x*e.y-this.y*e.x},angle:function(e){return
Math.acos(this.dot(e)/(this.length()*e.length()))},distanceSqr:function(e){return
this.x*e.x+this.y*e.y},distance:function(e){return
Math.sqrt(this.distanceSqr())}});e.Vec2=n,e.polarCCW=r,e.polarCW=i;var
s=t.extend({ctor:function(e){this.bodies=[],this.timeStep=1/60,this.onTicks=[],this.ticker=new
o,this.gravity=new
n(0,300),e|={};for(var
t
in
e)e.hasOwnProperty(t)&&this.hasOwnProperty(t)&&(this[t]=e[t])},start:function(){this.timer=this.ticker.timeout(function(e){this.tick(e),this.timer&&this.start()}.bind(this),this.timeStep)},pause:function(){this.ticker.cancel(this.timer),this.timer=undefined},tick:function(e){for(var
t
in
this.bodies){var
n=this.bodies[t];n.tick(e)}for(var
r
in
this.onTicks)this.onTicks[r](e)},add:function(e){e.force=this.gravity.clone().multiply(e.mass),this.bodies.push(e)},onTick:function(e){this.onTicks.push(e)}});e.World=s;var
o=t.extend({ctor:function(){this.lastTime=0},timeout:function(e,t){var
n=(new
Date).getTime(),r=t*1e3-n+this.lastTime;n+=Math.max(0,r);var
i=window.setTimeout(function(){e(t)},r);return
this.lastTime=n,i},cancel:function(e){window.clearTimeout(e)}});e.Ticker=o;var
u=t.extend({ctor:function(e,t,n,r){this.l=e,this.t=t,this.r=n,this.b=r},doesCollide:function(e){return!(this.b<e.t||this.t>e.b||this.r<e.l||this.l>e.r)}}),a=t.extend({ctor:function(e){this.position=new
n(0,0),this.mass=0,this.velocity=new
n(0,0),this.rotation=0,this.angularVelocity=0,this.invRotationalInertia=0;for(var
t
in
e)e.hasOwnProperty(t)&&this.hasOwnProperty(t)&&(this[t]=e[t]);this.force=new
n(0,0),this.mass!=0?this.invMass=1/this.mass:this.invMass=0},applyImpulse:function(e,t){var
n=t.clone().sub(this.position);this.angularVelocity+=n.cross(e)*this.invRotationalInertia,this.velocity.addOfMultiplied(e,this.invMass)},getSCAAt:function(e,t){var
n=e.clone().sub(this.position),r=n.cross(t);return
r*r*this.invRotationalInertia+this.invMass},getVelocityAt:function(e){var
t=e.clone().sub(this.position),n=t.rotatedCCW().multiply(this.angularVelocity);return
n.add(this.velocity)},intergrateVelocity:function(e){this.velocity.add(this.force.clone().multiply(this.invMass*e))},intergratePosition:function(e){this.position.add(this.velocity.clone().multiply(e))},intergrateRotation:function(e){this.rotation+=this.angularVelocity*e},tick:function(e){this.intergrateVelocity(e),this.intergratePosition(e),this.intergrateRotation(e)}});e.Body=a;var
f=a.extend({ctor:function(e){this._super(e),this.r=e.r,this.rSqr=this.r*this.r,this.invRotationalInteria=2*this.invMass/this.rSqr}});e.Circle=f;var
l=a.extend({ctor:function(e){this._super(e),this.size=e.size,this.halfsize=this.size.clone().multiply(.5),this.sizeSqr=this.size.lengthSqr(),this.invRotationalInertia=12*this.invMass/this.sizeSqr,this.rotationalInertia=1/this.invRotationalInertia},getAABB:function(){var
e=this.position.clone().sub(this.halfsize),t=this.position.clone().add(this.halfsize);return
new
u(e.x,e.y,t.x,t.y)},getNormalAt:function(e){var
t=e.clone().sub(this.position),n=new
r(this.rotation);if(Math.abs(t.dot(n))<=this.halfsize.x)return
n},getVertices:function(){var
e=r(this.rotation),t=e.rotatedCCW(),n=e.multiply(this.halfsize.x),i=t.multiply(this.halfsize.y),s=this.position.clone().add(n),o=this.position.clone().sub(n);return[s.clone().add(i),s.sub(i),o.clone().add(i),o.sub(i)]}});e.Rect=l,e.Collide={react_Circle_Circle:function(e,t){var
n=t.position.clone().sub(e.position),r=n.length();if(r<=e.r+t.r){var
i=1/r,s=t.velocity.clone().sub(e.velocity),o=s.dot(n)*i/s.length();o<=0&&(s.multiply(o),t.applyImpulse(s.clone().multiply(e.mass),n.clone().multiply(-t.r*i).add(t.position)),e.applyImpulse(s.multiply(-t.mass),n.multiply(e.r*i).add(e.position)))}},react_Vertiable_NormableStatic:function(e,t){var
n=e.getVertices();for(var
r
in
n){var
i=n[r],s=t.getNormalAt(i);if(s===undefined)continue;var
o=.9,u=-(1+o)/e.getSCAAt(i,s),a=e.getVelocityAt(i).dot(s)*u;if(a<0)continue;var
f=s.multiply(a);e.applyImpulse(f,i)}}};var
c=t.extend({ctor:function(e){this.canvas=document.querySelector(e),this.ctx=this.canvas.getContext("2d")},clear:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},circle:function(e,t,n,r){this.ctx.save(),this.ctx.beginPath(),this.ctx.setTransform(Math.cos(r),Math.sin(r),-Math.sin(r),Math.cos(r),e,t),this.ctx.arc(0,0,n,0,2*Math.PI,!1),this.ctx.lineTo(0,0),this.ctx.arc(0,0,3,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.restore()},rect:function(e,t,n,r,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.setTransform(Math.cos(i),Math.sin(i),-Math.sin(i),Math.cos(i),e,t),this.ctx.strokeRect(-n/2,-r/2,n,r),this.ctx.beginPath(),this.ctx.moveTo(n/2,0),this.ctx.lineTo(0,0),this.ctx.arc(0,0,3,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()}});return
e.Render=c,e});
